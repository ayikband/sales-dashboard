<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ayƒ±k Band Sales Dashboard</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- External Libs -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>

    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-left">
            <img src="https://www.konveyorbant.com/wp-content/themes/ayik-band/assets/image/logo/logo2.svg"
                alt="Ayƒ±k Band Logo" class="logo">
            <div class="brand-text">
                <h1>Satƒ±≈ü Paneli</h1>
                <span class="subtitle">Performans √ñzeti</span>
            </div>
        </div>
        <div class="header-right">
            <div class="quarter-badge" id="quarterLabel">√á-- ----</div>
            <button id="exportPdfBtn" class="btn btn-primary" style="margin-right: 10px;">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path
                        d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
                    <path
                        d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z" />
                </svg>
                PDF ƒ∞ndir
            </button>
            <button id="ratesBtn" class="btn btn-secondary">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M1 3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1H1zm7 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" />
                    <path
                        d="M0 5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V5zm3 0a2 2 0 0 1-2 2v4a2 2 0 0 1 2 2h10a2 2 0 0 1 2-2V7a2 2 0 0 1-2-2H3z" />
                </svg>
                Kurlar
            </button>

        </div>
    </header>

    <!-- Upload Overlay (Initial State) -->
    <div id="uploadOverlay" class="upload-overlay">
        <div class="upload-card">
            <h2>Satƒ±≈ü Verilerini Y√ºkle</h2>
            <p>Analize ba≈ülamak i√ßin Excel dosyanƒ±zƒ± y√ºkleyin.</p>
            <label for="fileInput" class="upload-area">
                <span class="icon">üìÇ</span>
                <span class="text">.xlsx Dosyasƒ± Se√ßmek ƒ∞√ßin Tƒ±klayƒ±n</span>
            </label>
            <input type="file" id="fileInput" accept=".xlsx, .xls" hidden>
            <p class="file-status" id="uploadStatus">Dosya se√ßilmedi</p>
        </div>
    </div>

    <!-- Main Dashboard -->
    <main id="mainDashboard" class="hidden">

        <!-- Print Header (Visible only in PDF) -->
        <div id="printHeader" class="print-header">
            <img src="https://www.konveyorbant.com/wp-content/themes/ayik-band/assets/image/logo/logo2.svg" alt="Logo"
                class="print-logo">
            <div class="print-text">
                <h1>Ayƒ±k Band Satƒ±≈ü Raporu</h1>
                <p id="printDateRange">--</p>
            </div>
        </div>

        <!-- Sticky Filter Bar -->
        <section class="filter-bar">
            <div class="filter-group">
                <select id="filterMonth">
                    <option value="">T√ºm Aylar</option>
                </select>
                <select id="filterManager">
                    <option value="">T√ºm B√∂lge M√ºd√ºrleri</option>
                </select>
                <select id="filterRegion">
                    <option value="">T√ºm B√∂lgeler</option>
                </select>
                <select id="filterCity">
                    <option value="">T√ºm ≈ûehirler</option>
                </select>
                <select id="filterType">
                    <option value="">T√ºm Tipler</option>
                </select>
                <select id="filterCurrency">
                    <option value="">T√ºm Para Birimleri</option>
                </select>
            </div>
            <div class="filter-actions">
                <div class="search-wrapper">
                    <input type="text" id="custSearch" placeholder="M√º≈üteri Ara...">
                </div>
                <div class="toggle-wrapper" title="Normalle≈ütirilmi≈ü EUR ve Orijinal Para Birimi arasƒ±nda ge√ßi≈ü yap">
                    <label class="switch">
                        <input type="checkbox" id="currencyToggle" checked>
                        <span class="slider round"></span>
                    </label>
                    <span class="toggle-label">EUR Kar≈üƒ±lƒ±ƒüƒ±</span>
                </div>
                <button id="resetFiltersBtn" class="btn btn-outline">Sƒ±fƒ±rla</button>
            </div>
        </section>

        <!-- Stats Grid -->
        <section class="kpi-grid">
            <div class="card kpi-card">
                <h3>KDV Hari√ß Toplam Satƒ±≈ü</h3>
                <div class="value primary" id="kpiNetSales">--</div>
                <div class="subtext" id="kpiTargetAttainment">Hedef: --%</div>
            </div>
            <div class="card kpi-card">
                <h3>Fatura Sayƒ±sƒ±</h3>
                <div class="value" id="kpiInvoices">--</div>
                <div class="subtext" id="kpiAvgInv">Ort: --</div>
            </div>
            <div class="card kpi-card">
                <h3>M√º≈üteri Sayƒ±sƒ±</h3>
                <div class="value success" id="kpiCustomers">--</div>
                <div class="subtext">Bu d√∂nem aktif</div>
            </div>
            <div class="card kpi-card">
                <h3>√úr√ºn / Hizmet Daƒüƒ±lƒ±mƒ±</h3>
                <div class="chart-with-legend">
                    <div class="mini-chart-wrapper">
                        <canvas id="kpiChartMix"></canvas>
                    </div>
                    <div id="kpiLegendMix" class="custom-legend small"></div>
                </div>
            </div>
        </section>

        <!-- Charts Grid -->
        <section class="charts-grid">
            <div class="card chart-card wide">
                <div class="chart-header">
                    <h3>Satƒ±≈ü Trendi (G√ºnl√ºk)</h3>
                    <div class="toggle-wrapper">
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" id="weeklyToggle"> Haftalƒ±k
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" id="cumulativeToggle"> K√ºm√ºlatif
                        </label>
                    </div>
                </div>
                <!-- Progress Bar Section -->

                <div class="chart-container">
                    <canvas id="chartTrend"></canvas>
                </div>

                <!-- Corporate Targets Infographics -->
                <div class="corporate-targets-grid" id="corporateTargetsSection">
                    <!-- Daily Target -->
                    <div class="target-infographic">
                        <div class="info-header">
                            <span class="info-label">G√ºnl√ºk Hedef (K√ºm√ºlatif) <small id="dailyTgtVal">--</small></span>
                            <span class="info-percent" id="infoDailyPct">0%</span>
                        </div>
                        <div class="progress-track chic">
                            <div class="progress-fill chic-gradient" id="progDaily" style="width: 0%"></div>
                        </div>
                        <div class="info-sub">Ger√ßekle≈üen: <span id="infoDailyAct">--</span></div>
                    </div>

                    <!-- Quarterly Target -->
                    <div class="target-infographic">
                        <div class="info-header">
                            <span class="info-label">√áeyreklik Hedef <small>2.625.000 ‚Ç¨</small></span>
                            <span class="info-percent" id="infoQuarterPct">0%</span>
                        </div>
                        <div class="progress-track chic">
                            <div class="progress-fill chic-gradient" id="progQuarter" style="width: 0%"></div>
                        </div>
                        <div class="info-sub">Ger√ßekle≈üen: <span id="infoQuarterAct">--</span></div>
                    </div>

                    <!-- Annual Target -->
                    <div class="target-infographic">
                        <div class="info-header">
                            <span class="info-label">Yƒ±llƒ±k Hedef <small>10.500.000 ‚Ç¨</small></span>
                            <span class="info-percent" id="infoAnnualPct">0%</span>
                        </div>
                        <div class="progress-track chic">
                            <div class="progress-fill chic-gradient" id="progAnnual" style="width: 0%"></div>
                        </div>
                        <div class="info-sub">Ger√ßekle≈üen: <span id="infoAnnualAct">--</span></div>
                    </div>
                </div>
            </div>
            <div class="card chart-card" id="cardManagerTargets">
                <h3>B√∂lge M√ºd√ºr√º Hedef Takibi</h3>
                <div id="managerTargetsContainer" class="manager-targets-grid">
                    <!-- Injected by JS -->
                </div>
            </div>
            <div class="card chart-card" id="cardCurrency">
                <h3>D√∂viz Daƒüƒ±lƒ±mƒ± </h3>
                <div class="chart-with-legend-side">
                    <div class="chart-wrapper">
                        <canvas id="chartCurrency"></canvas>
                    </div>
                    <div id="legendCurrency" class="custom-legend"></div>
                </div>
            </div>
            <div class="card chart-card" id="cardRegion">
                <h3>B√∂lgesel Daƒüƒ±lƒ±m</h3>
                <div class="chart-container">
                    <canvas id="chartRegion"></canvas>
                </div>
            </div>
            <div class="card chart-card" id="cardTop5">
                <h3>En B√ºy√ºk 5 Satƒ±≈ü</h3>
                <div class="chart-container">
                    <div id="topInvoicesList" class="top-invoices-list"></div>
                </div>
            </div>
        </section>

        <!-- Top Managers Customers Grid -->
        <section class="top-customers-grid" id="topManagersCustomersSection">
            <h3 class="section-title">B√∂lge M√ºd√ºrleri ve M√º≈üterileri</h3>
            <div id="topManagersCustomersContainer" class="three-col-grid">
                <!-- Injected by JS -->
            </div>
        </section>

        <!-- Data Table -->
        <section class="table-section">
            <div class="card">
                <div class="table-header-row">
                    <h3>Detaylƒ± D√∂k√ºm</h3>
                    <div class="pagination-controls">
                        Sayfa ba≈üƒ±na satƒ±r:
                        <select id="rowsPerPage">
                            <option value="10">10</option>
                            <option value="25" selected>25</option>
                            <option value="50">50</option>
                        </select>
                        <span id="pageInfo">1-25 / --</span>
                        <button id="prevPageFn" class="btn-sm">‚Äπ</button>
                        <button id="nextPageFn" class="btn-sm">‚Ä∫</button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table id="detailTable">
                        <thead>
                            <tr>
                                <th data-sort="date">Tarih ‚¨ç</th>
                                <th data-sort="invNo">Fatura No ‚¨ç</th>
                                <th data-sort="customer">M√º≈üteri ‚¨ç</th>
                                <th data-sort="manager">B√∂lge M√ºd√ºr√º ‚¨ç</th>
                                <th data-sort="region">B√∂lge ‚¨ç</th>
                                <th data-sort="city">≈ûehir ‚¨ç</th>
                                <th data-sort="type">Tip ‚¨ç</th>
                                <th data-sort="curr">Para Birimi ‚¨ç</th>
                                <th data-sort="net" class="text-right">Net (Kar≈üƒ±lƒ±k) ‚¨ç</th>
                                <th data-sort="netOrig" class="text-right">Net (Orijinal) ‚¨ç</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rows injected by JS -->
                        </tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td colspan="8">TOPLAM</td>
                                <td class="text-right" id="tableTotalNet">--</td>
                                <td class="text-right"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </section>

    </main>



    <!-- Rates Modal -->
    <div id="ratesModal" class="modal-backdrop hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>D√∂viz Kurlarƒ± (EUR Tabanlƒ±)</h3>
                <button class="close-modal" id="closeRatesBtn">√ó</button>
            </div>
            <div class="modal-body">
                <p class="hint">"EUR Kar≈üƒ±lƒ±ƒüƒ±" aktifken diƒüer para birimlerini EUR'ya d√∂n√º≈üt√ºrmek i√ßin manuel kurlarƒ±
                    girin. Bunlarƒ± referans olarak da kullanƒ±n.</p>
                <div class="targets-list">
                    <div class="target-item">
                        <label>EUR / USD</label>
                        <input type="number" step="0.0001" id="rateUSD" placeholder="√∂r: 1.08">
                    </div>
                    <div class="target-item">
                        <label>EUR / GBP</label>
                        <input type="number" step="0.0001" id="rateGBP" placeholder="√∂r: 0.85">
                    </div>
                    <div class="target-item">
                        <label>EUR / TRY</label>
                        <input type="number" step="0.01" id="rateTRY" placeholder="√∂r: 35.00">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="saveRatesBtn">Kurlarƒ± Kaydet</button>
            </div>
        </div>
    </div>

    <!-- Deal Details Modal -->
    <div id="dealDetailsModal" class="modal-backdrop hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Fatura Detaylarƒ±</h3>
                <button class="close-modal" id="closeDealBtn">√ó</button>
            </div>
            <div class="modal-body">
                <div class="deal-details-grid" id="dealDetailsContent">
                    <!-- Content injected by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="app.js"></script>
</body>

</html>
